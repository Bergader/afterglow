<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>afterglow.midi documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Afterglow</span> <span class="project-version">0.2.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>afterglow</span></div></div></li><li class="depth-2 branch"><a href="afterglow.beyond.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>beyond</span></div></a></li><li class="depth-2 branch"><a href="afterglow.channels.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>channels</span></div></a></li><li class="depth-2"><a href="afterglow.controllers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>controllers</span></div></a></li><li class="depth-3 branch"><a href="afterglow.controllers.ableton-push.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ableton-push</span></div></a></li><li class="depth-3 branch"><a href="afterglow.controllers.color.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>color</span></div></a></li><li class="depth-3 branch"><a href="afterglow.controllers.launchpad-pro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>launchpad-pro</span></div></a></li><li class="depth-3"><a href="afterglow.controllers.tempo.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tempo</span></div></a></li><li class="depth-2 branch"><a href="afterglow.core.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="afterglow.coremidi4j.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coremidi4j</span></div></a></li><li class="depth-2 branch"><a href="afterglow.dj-link.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dj-link</span></div></a></li><li class="depth-2"><a href="afterglow.effects.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>effects</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.channel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>channel</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.color.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>color</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.cues.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cues</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.dimmer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dimmer</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.fun.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fun</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.movement.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>movement</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.oscillators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>oscillators</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.params.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>params</span></div></a></li><li class="depth-3"><a href="afterglow.effects.show-variable.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>show-variable</span></div></a></li><li class="depth-2 branch"><a href="afterglow.examples.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>examples</span></div></a></li><li class="depth-2"><a href="afterglow.fixtures.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fixtures</span></div></a></li><li class="depth-3 branch"><a href="afterglow.fixtures.american-dj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>american-dj</span></div></a></li><li class="depth-3 branch"><a href="afterglow.fixtures.blizzard.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blizzard</span></div></a></li><li class="depth-3 branch"><a href="afterglow.fixtures.chauvet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chauvet</span></div></a></li><li class="depth-3"><a href="afterglow.fixtures.qxf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>qxf</span></div></a></li><li class="depth-2 branch"><a href="afterglow.init.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>init</span></div></a></li><li class="depth-2 branch current"><a href="afterglow.midi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>midi</span></div></a></li><li class="depth-2 branch"><a href="afterglow.rhythm.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rhythm</span></div></a></li><li class="depth-2 branch"><a href="afterglow.show.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>show</span></div></a></li><li class="depth-2 branch"><a href="afterglow.show-context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>show-context</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shows</span></div></div></li><li class="depth-3"><a href="afterglow.shows.sallie.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sallie</span></div></a></li><li class="depth-2 branch"><a href="afterglow.transform.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>transform</span></div></a></li><li class="depth-2 branch"><a href="afterglow.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="afterglow.version.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>version</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></div></li><li class="depth-3 branch"><a href="afterglow.web.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-3 branch"><a href="afterglow.web.layout.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>layout</span></div></a></li><li class="depth-3 branch"><a href="afterglow.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>routes</span></div></div></li><li class="depth-4 branch"><a href="afterglow.web.routes.home.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>home</span></div></a></li><li class="depth-4 branch"><a href="afterglow.web.routes.show-control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>show-control</span></div></a></li><li class="depth-4 branch"><a href="afterglow.web.routes.visualizer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>visualizer</span></div></a></li><li class="depth-4"><a href="afterglow.web.routes.web-repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web-repl</span></div></a></li><li class="depth-3"><a href="afterglow.web.session.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>session</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="afterglow.midi.html#var--.3EClockSync"><div class="inner"><span>-&gt;ClockSync</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-abs-tolerance"><div class="inner"><span>abs-tolerance</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-add-aftertouch-mapping"><div class="inner"><span>add-aftertouch-mapping</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-add-control-mapping"><div class="inner"><span>add-control-mapping</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-add-disconnected-device-handler.21"><div class="inner"><span>add-disconnected-device-handler!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-add-global-handler.21"><div class="inner"><span>add-global-handler!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-add-new-device-handler.21"><div class="inner"><span>add-new-device-handler!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-add-note-mapping"><div class="inner"><span>add-note-mapping</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-bpm-to-interval"><div class="inner"><span>bpm-to-interval</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-cm4j-device.3F"><div class="inner"><span>cm4j-device?</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-cm4j-installed.3F"><div class="inner"><span>cm4j-installed?</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-create-tempo-tap-handler"><div class="inner"><span>create-tempo-tap-handler</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-current-clock-sources"><div class="inner"><span>current-clock-sources</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-current-traktor-beat-phase-sources"><div class="inner"><span>current-traktor-beat-phase-sources</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-describe-device-filter"><div class="inner"><span>describe-device-filter</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-dev-tolerance"><div class="inner"><span>dev-tolerance</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-filter-devices"><div class="inner"><span>filter-devices</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-find-midi-in"><div class="inner"><span>find-midi-in</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-find-midi-out"><div class="inner"><span>find-midi-out</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-IClockSync"><div class="inner"><span>IClockSync</span></div></a></li><li class="depth-2 branch"><a href="afterglow.midi.html#var-sync-start"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sync-start</span></div></a></li><li class="depth-2 branch"><a href="afterglow.midi.html#var-sync-status"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sync-status</span></div></a></li><li class="depth-2"><a href="afterglow.midi.html#var-sync-stop"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sync-stop</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-identify-mapping"><div class="inner"><span>identify-mapping</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-interval-to-bpm"><div class="inner"><span>interval-to-bpm</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-mac.3F"><div class="inner"><span>mac?</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-map-.3EClockSync"><div class="inner"><span>map-&gt;ClockSync</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-midi-device-key"><div class="inner"><span>midi-device-key</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-midi-port-filter"><div class="inner"><span>midi-port-filter</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-mmj-device.3F"><div class="inner"><span>mmj-device?</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-mmj-installed.3F"><div class="inner"><span>mmj-installed?</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-open-inputs-if-needed.21"><div class="inner"><span>open-inputs-if-needed!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-open-outputs-if-needed.21"><div class="inner"><span>open-outputs-if-needed!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-remove-aftertouch-mapping"><div class="inner"><span>remove-aftertouch-mapping</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-remove-control-mapping"><div class="inner"><span>remove-control-mapping</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-remove-disconnected-device-handler.21"><div class="inner"><span>remove-disconnected-device-handler!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-remove-global-handler.21"><div class="inner"><span>remove-global-handler!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-remove-new-device-handler.21"><div class="inner"><span>remove-new-device-handler!</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-remove-note-mapping"><div class="inner"><span>remove-note-mapping</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-same-device.3F"><div class="inner"><span>same-device?</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-scan-interval"><div class="inner"><span>scan-interval</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-scan-midi-environment"><div class="inner"><span>scan-midi-environment</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-std-dev"><div class="inner"><span>std-dev</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-sync-to-midi-clock"><div class="inner"><span>sync-to-midi-clock</span></div></a></li><li class="depth-1"><a href="afterglow.midi.html#var-watch-for"><div class="inner"><span>watch-for</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">afterglow.midi</h1><div class="doc"><div class="markdown"><p>Handles MIDI communication, including syncing a show metronome to MIDI clock pulses.</p></div></div><div class="public anchor" id="var--.3EClockSync"><h3>-&gt;ClockSync</h3><div class="usage"><code>(-&gt;ClockSync metronome midi-clock-source timestamps means traktor-info)</code></div><div class="doc"><div class="markdown"><p>Positional factory function for class afterglow.midi.ClockSync.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L771">view source</a></div></div><div class="public anchor" id="var-abs-tolerance"><h3>abs-tolerance</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>If we are going to adjust the BPM, the adjustment we are going to make needs to represent at least this many milliseconds per MIDI clock tick (to reduce jitter).</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L701">view source</a></div></div><div class="public anchor" id="var-add-aftertouch-mapping"><h3>add-aftertouch-mapping</h3><div class="usage"><code>(add-aftertouch-mapping device-filter channel note f)</code></div><div class="doc"><div class="markdown"><p>Register a handler function <code>f</code> to be called whenever a MIDI aftertouch (polyphonic key pressure) message is received from the specified device, on the specified <code>channel</code> and <code>note</code> number. Any subsequent MIDI message which matches will be passed to <code>f</code> as its single argument.</p>
<p>The first MIDI input source whose device matches the <code>device-filter</code> (using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>) will be chosen.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L1008">view source</a></div></div><div class="public anchor" id="var-add-control-mapping"><h3>add-control-mapping</h3><div class="usage"><code>(add-control-mapping device-filter channel control-number f)</code></div><div class="doc"><div class="markdown"><p>Register a handler function <code>f</code> to be called whenever a MIDI controller change message is received from the specified device, on the specified <code>channel</code> and <code>controller</code> number. Any subsequent MIDI message which matches will be passed to <code>f</code> as its single argument.</p>
<p>The first MIDI input source whose device matches the <code>device-filter</code> (using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>) will be chosen.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L951">view source</a></div></div><div class="public anchor" id="var-add-disconnected-device-handler.21"><h3>add-disconnected-device-handler!</h3><div class="usage"><code>(add-disconnected-device-handler! device f)</code></div><div class="doc"><div class="markdown"><p>Add a function to be called whenever the specified device disappears from the MIDI environment. The <code>device</code> argument is a <code>:midi-device</code> map from <code>overtone.midi</code> representing device whose removal is of interest. The function must return quickly so as not to stall the delay of other MIDI events; lengthy operations must be performed on another thread.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L107">view source</a></div></div><div class="public anchor" id="var-add-global-handler.21"><h3>add-global-handler!</h3><div class="usage"><code>(add-global-handler! f)</code></div><div class="doc"><div class="markdown"><p>Add a function to be called whenever any MIDI message is received. The function will be called with the message, and must return quickly, so as to not block delivery to other recipients.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L168">view source</a></div></div><div class="public anchor" id="var-add-new-device-handler.21"><h3>add-new-device-handler!</h3><div class="usage"><code>(add-new-device-handler! f)</code></div><div class="doc"><div class="markdown"><p>Add a function to be called whenever a new device appears in the MIDI environment. It will be passed a single argument, the <code>:midi-device</code> map from <code>overtone.midi</code> representing the new device. It must return quickly so as not to stall the delay of other MIDI events; lengthy operations must be performed on another thread.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L82">view source</a></div></div><div class="public anchor" id="var-add-note-mapping"><h3>add-note-mapping</h3><div class="usage"><code>(add-note-mapping device-filter channel note f)</code></div><div class="doc"><div class="markdown"><p>Register a handler function <code>f</code> to be called whenever a MIDI note message is received from the specified device, on the specified <code>channel</code> and <code>note</code> number. Any subsequent MIDI message which matches will be passed to <code>f</code> as its single argument.</p>
<p>The first MIDI input source whose device matches the <code>device-filter</code> (using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>) will be chosen.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L980">view source</a></div></div><div class="public anchor" id="var-bpm-to-interval"><h3>bpm-to-interval</h3><div class="usage"><code>(bpm-to-interval bpm)</code></div><div class="doc"><div class="markdown"><p>Given a BPM, calculate the interval between MIDI clock pulses in milliseconds.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L685">view source</a></div></div><div class="public anchor" id="var-cm4j-device.3F"><h3>cm4j-device?</h3><div class="usage"><code>(cm4j-device? device)</code></div><div class="doc"><div class="markdown"><p>Checks whether a MIDI device was returned by the CoreMIDI4J MIDI extension.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L290">view source</a></div></div><div class="public anchor" id="var-cm4j-installed.3F"><h3>cm4j-installed?</h3><div class="usage"><code>(cm4j-installed?)</code></div><div class="doc"><div class="markdown"><p>Return true if the CoreMIDI4J MIDI extension is present.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L296">view source</a></div></div><div class="public anchor" id="var-create-tempo-tap-handler"><h3>create-tempo-tap-handler</h3><div class="usage"><code>(create-tempo-tap-handler metronome)</code></div><div class="doc"><div class="markdown"><p>Returns a function which implements a simple tempo-tap algorithm on the supplied metronome.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L649">view source</a></div></div><div class="public anchor" id="var-current-clock-sources"><h3>current-clock-sources</h3><div class="usage"><code>(current-clock-sources)</code></div><div class="doc"><div class="markdown"><p>Returns the set of MIDI input ports which are currently delivering MIDI clock messages.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L878">view source</a></div></div><div class="public anchor" id="var-current-traktor-beat-phase-sources"><h3>current-traktor-beat-phase-sources</h3><div class="usage"><code>(current-traktor-beat-phase-sources)</code></div><div class="doc"><div class="markdown"><p>Returns the set of MIDI input ports which are currently delivering beat phase information in the format provided by the Afterglow Traktor controller mapping.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L888">view source</a></div></div><div class="public anchor" id="var-describe-device-filter"><h3>describe-device-filter</h3><div class="usage"><code>(describe-device-filter device-filter)</code></div><div class="doc"><div class="markdown"><p>Returns a description of a filter used to narrow down MIDI devices, if one was supplied, or the empty string if none was.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L799">view source</a></div></div><div class="public anchor" id="var-dev-tolerance"><h3>dev-tolerance</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>If we are going to adjust the BPM, the adjustment must be at least this many times the standard deviation in observed clock pulse timings, so we can avoid jitter due to unstable timing.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L707">view source</a></div></div><div class="public anchor" id="var-filter-devices"><h3>filter-devices</h3><div class="usage"><code>(filter-devices device-filter devices)</code></div><div class="doc"><div class="markdown"><p>Return only those devices matching the supplied <code>device-filter</code>.</p>
<p>The elements of <code>devices</code> must all be <code>:midi-device</code> maps as returned by <code>overtone.midi</code>.</p>
<p>If <code>device-filter</code> is <code>nil</code> or an empty string, <code>devices</code> is returned unfiltered. Otherwise it can be one of the following things:</p>
<ul>
  <li>
  <p>A <code>java.util.regex.Pattern</code>, which will be matched against each device name and description. If either match succeeds, the device will be included in the results.</p></li>
  <li>
  <p>A <code>String</code>, which will be turned into a <code>Pattern</code> which matches in a case-insensitive way, as above. So if the device name or filter contains the string, ignoring case, the device will be included.</p></li>
  <li>
  <p>A <code>javax.sound.midi.MidiDevice</code> instance, which will match only the device that it implements.</p></li>
  <li>
  <p>A <code>javax.sound.midi.MidiDevice.Info</code> instance, which will match only the device it describes.</p></li>
  <li>
  <p>A <code>:midi-device</code> map, which will match only itself.</p></li>
  <li>
  <p>A function, which will be called with each device, and the device will be included if the function returns a <code>true</code> value.</p></li>
</ul>
<p>Anything else will be converted to a string and matched as above.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L823">view source</a></div></div><div class="public anchor" id="var-find-midi-in"><h3>find-midi-in</h3><div class="usage"><code>(find-midi-in device-filter)</code></div><div class="doc"><div class="markdown"><p>Find the first MIDI input port matching the specified <code>device-filter</code> using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>, or throw an exception if no matches can be found.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L1093">view source</a></div></div><div class="public anchor" id="var-find-midi-out"><h3>find-midi-out</h3><div class="usage"><code>(find-midi-out device-filter)</code></div><div class="doc"><div class="markdown"><p>Find the first MIDI output port matching the specified <code>device-filter</code> using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>, or throw an exception if no matches can be found.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L1103">view source</a></div></div><div class="public anchor" id="var-IClockSync"><h3>IClockSync</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A simple protocol for our clock sync object, allowing it to be started and stopped, and the status checked.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-sync-start"><h3>sync-start</h3><div class="usage"><code>(sync-start this)</code></div><div class="doc"><div class="markdown"><p>Start synchronizing your metronome.</p></div></div></div><div class="public anchor" id="var-sync-status"><h3>sync-status</h3><div class="usage"><code>(sync-status this)</code></div><div class="doc"><div class="markdown"><p>Report on how well synchronization is working. Returns a map with keys <code>:type</code> (a keyword that uniquely identifies the kind of sync in effect, currently chosen from <code>:manual</code>, <code>:midi</code>, and <code>:dj-link</code>), <code>:current</code> (true if sync appears to be working at the present time), <code>:level</code> (a keyword that indicates how strong of a sync is being performed; <code>:bpm</code> means basic BPM following, <code>:beat</code> adds tracking of beat locations, <code>:bar</code> adds tracking of bar starts (down beats), and <code>:phrase</code> would add tracking of phrase starts, if any sync mechanism ever offers that), and <code>:status</code>, which is a human-oriented summmary of the status.</p></div></div></div><div class="public anchor" id="var-sync-stop"><h3>sync-stop</h3><div class="usage"><code>(sync-stop this)</code></div><div class="doc"><div class="markdown"><p>Stop synchronizing your metronome.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L661">view source</a></div></div><div class="public anchor" id="var-identify-mapping"><h3>identify-mapping</h3><div class="usage"><code>(identify-mapping)</code><code>(identify-mapping timeout)</code></div><div class="doc"><div class="markdown"><p>Report on the next MIDI control or note message received, to aid in setting up a mapping to a button, fader, or knob. Call this, then twiddle the knob, press the button, or move the fader, and see what Afterglow received. Pass a timeout in ms to control how long it will wait for a message (the default is ten seconds). This is an upper limit; if a message is received before the timeout, it will be reported immediately.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L926">view source</a></div></div><div class="public anchor" id="var-interval-to-bpm"><h3>interval-to-bpm</h3><div class="usage"><code>(interval-to-bpm interval)</code></div><div class="doc"><div class="markdown"><p>Given an interval between MIDI clock pulses in milliseconds, calculate the implied beats per minute value, to the nearest hundredth of a beat.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L678">view source</a></div></div><div class="public anchor" id="var-mac.3F"><h3>mac?</h3><div class="usage"><code>(mac?)</code></div><div class="doc"><div class="markdown"><p>Return true if we seem to be running on a Mac.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L274">view source</a></div></div><div class="public anchor" id="var-map-.3EClockSync"><h3>map-&gt;ClockSync</h3><div class="usage"><code>(map-&gt;ClockSync m__6522__auto__)</code></div><div class="doc"><div class="markdown"><p>Factory function for class afterglow.midi.ClockSync, taking a map of keywords to field values.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L771">view source</a></div></div><div class="public anchor" id="var-midi-device-key"><h3>midi-device-key</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Contains a function which returns the key by which an overtone.midi <code>:midi-device</code> map should be indexed in a map. This must be a value which is unique to each device, and stable over time as long as that device is present in the MIDI environment. The first time <code>midi-device-key</code> is dereferenced, the function is created. The same function is returned whenever it is dereferenced in the future.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L65">view source</a></div></div><div class="public anchor" id="var-midi-port-filter"><h3>midi-port-filter</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Contains a filter which selects midi inputs and outputs we actually want to use. The first time the value is dereferenced, a filter appropriate to the current environment will be created, and that filter will be returned whenever the value is dereferenced again.</p>
<ul>
  <li>
  <p>If this is a Mac, and the CoreMIDI4J MIDI extension is present and  working, the filter will accept only its devices.</p></li>
  <li>
  <p>Otherwise, if the Humatic MMJ extension is operating (also on a  Mac), the filter which will accept only MMJ&rsquo;s versions of ports  which it offers in parallel with the standard implementation, but  will accept the standard SPI&rsquo;s implementation of ports which MMJ  does not offer.</p></li>
  <li>
  <p>Otherwise, the filter accepts all ports.</p></li>
</ul></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L301">view source</a></div></div><div class="public anchor" id="var-mmj-device.3F"><h3>mmj-device?</h3><div class="usage"><code>(mmj-device? device)</code></div><div class="doc"><div class="markdown"><p>Checks whether a MIDI device was returned by the Humatic mmj MIDI extension.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L279">view source</a></div></div><div class="public anchor" id="var-mmj-installed.3F"><h3>mmj-installed?</h3><div class="usage"><code>(mmj-installed?)</code></div><div class="doc"><div class="markdown"><p>Return true if the Humatic mmj MIDI extension is present.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L285">view source</a></div></div><div class="public anchor" id="var-open-inputs-if-needed.21"><h3>open-inputs-if-needed!</h3><div class="usage"><code>(open-inputs-if-needed!)</code></div><div class="doc"><div class="markdown"><p>Make sure the MIDI input ports are open and ready to distribute events. Returns the <code>:midi-device</code> maps returned by <code>overtone.midi</code> representing the opened inputs.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L378">view source</a></div></div><div class="public anchor" id="var-open-outputs-if-needed.21"><h3>open-outputs-if-needed!</h3><div class="usage"><code>(open-outputs-if-needed!)</code></div><div class="doc"><div class="markdown"><p>Make sure the MIDI output ports are open and ready to receive events. Returns the <code>:midi-device</code> maps returned by <code>overtone.midi</code> representing the opened outputs.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L398">view source</a></div></div><div class="public anchor" id="var-remove-aftertouch-mapping"><h3>remove-aftertouch-mapping</h3><div class="usage"><code>(remove-aftertouch-mapping device-filter channel note f)</code></div><div class="doc"><div class="markdown"><p>Unregister a handler previously registered with <a href="afterglow.midi.html#var-add-aftertouch-mapping">add-aftertouch-mapping</a>.</p>
<p>The first MIDI input source whose device matches the <code>device-filter</code> (using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>) will be chosen.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L1025">view source</a></div></div><div class="public anchor" id="var-remove-control-mapping"><h3>remove-control-mapping</h3><div class="usage"><code>(remove-control-mapping device-filter channel control-number f)</code></div><div class="doc"><div class="markdown"><p>Unregister a handler previously registered with <a href="afterglow.midi.html#var-add-control-mapping">add-control-mapping</a>.</p>
<p>The first MIDI input source whose device matches the <code>device-filter</code> (using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>) will be chosen.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L967">view source</a></div></div><div class="public anchor" id="var-remove-disconnected-device-handler.21"><h3>remove-disconnected-device-handler!</h3><div class="usage"><code>(remove-disconnected-device-handler! device f)</code></div><div class="doc"><div class="markdown"><p>No longer call the specified function if specified device disappears from the MIDI environment. The <code>device</code> argument is a <code>:midi-device</code> map from <code>overtone.midi</code> representing device whose removal is no longer of interest.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L118">view source</a></div></div><div class="public anchor" id="var-remove-global-handler.21"><h3>remove-global-handler!</h3><div class="usage"><code>(remove-global-handler! f)</code></div><div class="doc"><div class="markdown"><p>Remove a function that was being called whenever any MIDI message is received.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L176">view source</a></div></div><div class="public anchor" id="var-remove-new-device-handler.21"><h3>remove-new-device-handler!</h3><div class="usage"><code>(remove-new-device-handler! f)</code></div><div class="doc"><div class="markdown"><p>Stop calling the specified function to be called whenever a new device appears in the MIDI environment.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L92">view source</a></div></div><div class="public anchor" id="var-remove-note-mapping"><h3>remove-note-mapping</h3><div class="usage"><code>(remove-note-mapping device-filter channel note f)</code></div><div class="doc"><div class="markdown"><p>Unregister a handler previously registered with <a href="afterglow.midi.html#var-add-note-mapping">add-note-mapping</a>.</p>
<p>The first MIDI input source whose device matches the <code>device-filter</code> (using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>) will be chosen.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L996">view source</a></div></div><div class="public anchor" id="var-same-device.3F"><h3>same-device?</h3><div class="usage"><code>(same-device? a b)</code></div><div class="doc"><div class="markdown"><p>Checks whether two <code>:midi-device</code> maps seem to refer to the same device, in a slightly more efficient way than comparing the entire map.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L75">view source</a></div></div><div class="public anchor" id="var-scan-interval"><h3>scan-interval</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>How often should we scan for changes in the MIDI environment (devices that have been disconnected, or new devices which have connected). This is used only when <a href="https://github.com/DerekCook/CoreMidi4J">CoreMIDI4J</a> is not installed, sine CoreMIDI4J gives us proactive notification of changes to the MIDI environment. The value is in milliseconds, so the default means to check every two seconds. Changes to this value will take effect after the next scan completes.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L552">view source</a></div></div><div class="public anchor" id="var-scan-midi-environment"><h3>scan-midi-environment</h3><div class="usage"><code>(scan-midi-environment)</code></div><div class="doc"><div class="markdown"><p>Called either periodically to check for changes, or, if CoreMidi4J is installed, proactively in response to a reported change in the MIDI environment. Updates our notion of what MIDI devices are available, and notifies registered listeners of any changes.</p>
<p>Also sets up the thread used to process incoming MIDI events if that is not already running, and arranges for this function to be called as needed to keep up with future changes in the MIDI environment.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L447">view source</a></div></div><div class="public anchor" id="var-std-dev"><h3>std-dev</h3><div class="usage"><code>(std-dev samples)</code><code>(std-dev samples n mean)</code></div><div class="doc"><div class="markdown"><p>Calculate the standard deviation of a set of samples.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L691">view source</a></div></div><div class="public anchor" id="var-sync-to-midi-clock"><h3>sync-to-midi-clock</h3><div class="usage"><code>(sync-to-midi-clock)</code><code>(sync-to-midi-clock device-filter)</code></div><div class="doc"><div class="markdown"><p>Returns a sync function that will cause the beats-per-minute setting of the supplied metronome to track the MIDI clock messages received from the named MIDI source. This is intended for use with <a href="afterglow.show.html#var-sync-to-external-clock">afterglow.show/sync-to-external-clock</a>.</p>
<p>The <code>device-filter</code> argument is only needed if there is more than one connected device sending MIDI clock messages when this function is invoked; it will be used to filter the eligible devices using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>. An exception will be thrown if there is not exactly one matching eligible MIDI clock source.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L896">view source</a></div></div><div class="public anchor" id="var-watch-for"><h3>watch-for</h3><div class="usage"><code>(watch-for device-filter found-fn &amp; {:keys [lost-fn sleep-time], :or {sleep-time 1000}})</code></div><div class="doc"><div class="markdown"><p>Watches for a device that matches <code>device-filter</code> (using <a href="afterglow.midi.html#var-filter-devices">filter-devices</a>). If it is present when this function is called, or whenever a matching device is connected in the future (as long as none already was), <code>found-fn</code> will be called, with no arguments. This is useful for setting up MIDI mappings to the device whenever it is present. If the device is disconnected and later reconnected, <code>found-fn</code> will be called again, so those bindings can be counted on to be present whenver the device is available.</p>
<p>If there is any cleanup that you need to perform when the device is disconnected, you can pass the optional keyword argument <code>:lost-fn</code> along with a function to be called (also with no arguments) whenever a device reported by <code>found-fn</code> has disappeared. You do not need to use <code>:lost-fn</code> to clean up MIDI bindings created by <code>found-fn</code>, because Afterglow automatically cleans up any MIDI bindings for devices which have been disconnected. But if you have your own data structures or state that you want to update, you can use <code>:lost-fn</code> to do that.</p>
<p>In order to give the newly-attached device time to stabilize before trying to send messages to it, <code>watch-for</code> waits for a second after it is seen before calling <code>found-fn</code>. If your device needs more (or less) time to stabilize, you can pass a number of milliseconds after the optional keyword argument <code>:sleep-time</code> to configure this delay.</p>
<p>The return value of <code>watch-for</code> is a function that you can call to cancel the watcher if you no longer need it.</p></div></div><div class="src-link"><a href="https://github.com/brunchboy/afterglow/blob/master/src/afterglow/midi.clj#L1037">view source</a></div></div></div></body></html>