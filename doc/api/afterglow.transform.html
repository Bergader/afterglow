<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>afterglow.transform documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Afterglow 0.1.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>afterglow</span></div></div></li><li class="depth-2 branch"><a href="afterglow.channels.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>channels</span></div></a></li><li class="depth-2"><a href="afterglow.controllers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>controllers</span></div></a></li><li class="depth-3"><a href="afterglow.controllers.ableton-push.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ableton-push</span></div></a></li><li class="depth-2 branch"><a href="afterglow.core.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="afterglow.dj-link.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dj-link</span></div></a></li><li class="depth-2"><a href="afterglow.effects.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>effects</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.channel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>channel</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.color.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>color</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.dimmer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dimmer</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.fun.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fun</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.movement.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>movement</span></div></a></li><li class="depth-3 branch"><a href="afterglow.effects.oscillators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>oscillators</span></div></a></li><li class="depth-3"><a href="afterglow.effects.params.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>params</span></div></a></li><li class="depth-2 branch"><a href="afterglow.examples.html"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>examples</span></div></a></li><li class="depth-2"><a href="afterglow.fixtures.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fixtures</span></div></a></li><li class="depth-3 branch"><a href="afterglow.fixtures.blizzard.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blizzard</span></div></a></li><li class="depth-3"><a href="afterglow.fixtures.chauvet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chauvet</span></div></a></li><li class="depth-2 branch"><a href="afterglow.midi.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>midi</span></div></a></li><li class="depth-2 branch"><a href="afterglow.ola-client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ola-client</span></div></a></li><li class="depth-2 branch"><a href="afterglow.ola-messages.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ola-messages</span></div></a></li><li class="depth-2 branch"><a href="afterglow.ola-service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ola-service</span></div></a></li><li class="depth-2 branch"><a href="afterglow.rhythm.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rhythm</span></div></a></li><li class="depth-2 branch"><a href="afterglow.rpc-messages.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rpc-messages</span></div></a></li><li class="depth-2 branch"><a href="afterglow.rpc-service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rpc-service</span></div></a></li><li class="depth-2 branch"><a href="afterglow.show.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>show</span></div></a></li><li class="depth-2 branch"><a href="afterglow.show-context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>show-context</span></div></a></li><li class="depth-2 branch"><a href="afterglow.src-generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>src-generator</span></div></a></li><li class="depth-2 branch current"><a href="afterglow.transform.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transform</span></div></a></li><li class="depth-2 branch"><a href="afterglow.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></div></li><li class="depth-3 branch"><a href="afterglow.web.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-3 branch"><a href="afterglow.web.layout.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>layout</span></div></a></li><li class="depth-3 branch"><a href="afterglow.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>routes</span></div></div></li><li class="depth-4 branch"><a href="afterglow.web.routes.home.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>home</span></div></a></li><li class="depth-4"><a href="afterglow.web.routes.visualizer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>visualizer</span></div></a></li><li class="depth-3"><a href="afterglow.web.session.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>session</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="afterglow.transform.html#var-angle-to-dmx-value"><div class="inner"><span>angle-to-dmx-value</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-calculate-aim"><div class="inner"><span>calculate-aim</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-calculate-position"><div class="inner"><span>calculate-position</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-degrees"><div class="inner"><span>degrees</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-distance-from-legal-dmx-value"><div class="inner"><span>distance-from-legal-dmx-value</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-find-closest-legal-dmx-value-for-angle"><div class="inner"><span>find-closest-legal-dmx-value-for-angle</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-inches"><div class="inner"><span>inches</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-invert-direction"><div class="inner"><span>invert-direction</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-show-head-positions"><div class="inner"><span>show-head-positions</span></div></a></li><li class="depth-1"><a href="afterglow.transform.html#var-transform-fixture"><div class="inner"><span>transform-fixture</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">afterglow.transform</h2><div class="doc"><div class="markdown"><p>Functions for modeling light position and rotation. If you want to make use of Afterglow&rsquo;s spatial reasoning capabilities, you need to tell it, when patching a fixture, the location and orientation of that fixture.</p><p>The coordinate system in afterglow is from the perspective of the audience: Standing facing your show, the X axis passes through it increasing from left to right, the Y axis passes through it increasing away from the floor, and the Z axis passes through it increasing towards the audience. Pick an origin when setting up your show; in our case it is easiest to use the center of gravity of the main truss in our lighting rig, something else may be better for you.</p><p>When hanging your lights, measure how far the center of the light is from the origin of the show, in the X, Y, and Z directions. You don&rsquo;t need to get this precise to the millimeter level, but having it roughly right will make your spatial cues look great.</p><p>Distances in Afterglow are expressed in meters, though there are functions in this namespace for translating other units, if you do not have metric measuring tools handy.</p><p>Fixture definitions for Afterglow should include information about the positions of the light-emitting heads as offsets from the origin of the fixture, and a description of how to identify the origin of the fixture, so that when you patch the fixture and tell Afterglow the position of that origin with respect to the origin of the light show itself, it can calculate the location of each head.</p><p>For this to work you also need to tell Afterglow the orientation in which you have hung the fixture, expressed as a rotation away from the standard orientation described in the fixture definition. Yes, this can be painful to figure out, especially the first few times, and we have ideas about an iPhone app to help automate this, using the phone&rsquo;s camera and ability to track its own orientation. But until then, figure out how much you have rotated the fixture, in radians, around the X, then Y, then Z axes, in that order, and feed that in as well when patching it.</p><p>Again there are functions in this namespace to convert degrees to radians if they are easier for you to work with. In many cases, hopefully, the rotations will be simple. For example, if a light is hanging backwards with respect to its reference orientation, that is a rotation of zero around the X axis, Pi radians about the Y axis, and zero about the Z axis.</p><p>If a fixture does not have multiple heads, and is not a moving head fixture, you can generally ignore the rotation completely when patching it. Getting the orientation right is most important for moving heads, because Afterglow relies on having that information in order to figure out how to aim the light where you want it aimed.</p></div></div><div class="public anchor" id="var-angle-to-dmx-value"><h3>angle-to-dmx-value</h3><div class="usage"><code>(angle-to-dmx-value angle center-value half-circle-value)</code></div><div class="doc"><pre class="plaintext">Given an angle in radians, where positive means counterclockwise
around the axis, determine the DMX value needed to achieve that
amount of rotation of a fixture away from its center position, given
the DMX value of that center position, and the amount the DMX value
must change to cause a counterclockwise rotation halfway around a
circle. The return value may not be a legal DMX value if the fixture
cannot rotate that far; this will be weeded out in other parts of
the algorithm.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L149">view source</a></div></div><div class="public anchor" id="var-calculate-aim"><h3>calculate-aim</h3><div class="usage"><code>(calculate-aim fixture target-point former-values)</code></div><div class="doc"><pre class="plaintext">Given a fixture or head and a point in the frame of reference of
the light show, calculate the best pan and tilt values to send to
that fixture or head in order to aim it at that point.

If there is more than one legal solution, return the one that is
closest to the former values supplied. If no former values were
specified, then use the fixture&apos;s center position as the
default target value to stay close to.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L287">view source</a></div></div><div class="public anchor" id="var-calculate-position"><h3>calculate-position</h3><div class="usage"><code>(calculate-position fixture direction former-values)</code></div><div class="doc"><pre class="plaintext">Given a fixture or head and vector representing a direction in the
frame of reference of the light show, calculate the best pan and
tilt values to send to that fixture or head in order to aim it in
that direction.

If there is more than one legal solution, return the one that is
closest to the former values supplied. If no former values were
specified, then use the fixture&apos;s center position as the
default target value to stay close to.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L262">view source</a></div></div><div class="public anchor" id="var-degrees"><h3>degrees</h3><div class="usage"><code>(degrees deg)</code></div><div class="doc"><pre class="plaintext">Converts a number of degrees into the corresponding number of
radians.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L69">view source</a></div></div><div class="public anchor" id="var-distance-from-legal-dmx-value"><h3>distance-from-legal-dmx-value</h3><div class="usage"><code>(distance-from-legal-dmx-value value)</code></div><div class="doc"><pre class="plaintext">Measure how far a value is from being within the legal DMX range,
to help choose the least-worst solution if a fixture cannot actually
reach the desired position.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L161">view source</a></div></div><div class="public anchor" id="var-find-closest-legal-dmx-value-for-angle"><h3>find-closest-legal-dmx-value-for-angle</h3><div class="usage"><code>(find-closest-legal-dmx-value-for-angle angle center-value half-circle-value &amp; {:keys [target-value], :or {target-value center-value}})</code></div><div class="doc"><pre class="plaintext">Given a desired rotation from the center position (expressed in
radians, with positive values representing counterclockwise
rotations around the axis), the DMX value at which the fixture is in
its center position, and the amount the DMX value must change in
order to cause a counterclockwise rotation halfway around a circle,
find the DMX value which achieves that rotation, or if that is not
possible, the legal value which yields the closest possible
approximation, considering forward and backward rotations beyond a
full circle if necessary. Return a tuple of the resulting value and
a boolean indicating whether it achieves the desired angle.

If there is more than one legal solution, return the one that is
closest to the specified target value. If no target value is
specified (using the keyword parameter :target-value), then use the
fixture&apos;s center position as the default target value to stay close
to.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L170">view source</a></div></div><div class="public anchor" id="var-inches"><h3>inches</h3><div class="usage"><code>(inches in)</code></div><div class="doc"><pre class="plaintext">Converts a number of inches to the corresponding number of meters.
</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L64">view source</a></div></div><div class="public anchor" id="var-invert-direction"><h3>invert-direction</h3><div class="usage"><code>(invert-direction fixture direction)</code></div><div class="doc"><pre class="plaintext">Transform a direction vector in show coordinate space to the way it 
appears to a head or fixture that has been rotated when hanging.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L137">view source</a></div></div><div class="public anchor" id="var-show-head-positions"><h3>show-head-positions</h3><div class="usage"><code>(show-head-positions fixtures)</code></div><div class="doc"><pre class="plaintext">To help sanity-check fixtures&apos; position and orientation after
patching them, displays the positions of all heads of the list of
fixtures supplied. In the resulting list, top-level fixtures will be
identifiable by the presence of their :key entry in the map that
includes their position, and will be followed by their heads, if
any, until the next top-level fixture entry.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L124">view source</a></div></div><div class="public anchor" id="var-transform-fixture"><h3>transform-fixture</h3><div class="usage"><code>(transform-fixture fixture x y z x-rotation y-rotation z-rotation)</code></div><div class="doc"><pre class="plaintext">Determine the positions and orientations of the fixture and its
heads when it is patched into a show. X, Y, and Z are the position
of the fixture&apos;s origin point with respect to the show&apos;s origin, and
x-rotation, y-rotation, and z-rotation are the counter-clockwise
rotations around those axes, in that order, needed to get the
fixture from its reference orientation to the orientation in which
it was actually hung.</pre></div><div class="src-link"><a href="http://github.com/brunchboy/afterglow/blob/master/src/afterglow/transform.clj#L108">view source</a></div></div></div></body></html>